<div id="editBidForm" style='display:none;'><? View::show('main/elements/orders/editBid'); ?></div><script type="text/javascript">	$(function() {		// калькулятор		$('#delivery_total')				.keypress(function(event) {					validate_float(event);				})				.change(function() {					order_delivery_cost = $(this).val();					if (isNaN(order_delivery_cost) || order_delivery_cost == '')					{						order_delivery_cost = 0;					}					refreshEditTotals();				});		// интерактив		$('#editBid').ajaxForm({			dataType: 'html',			iframe: true,			beforeSubmit: function()			{				$('img.bid_progress').show();			},			success: function(response)			{				$('img.bid_progress').hide();				if (response)				{					success('top', 'Предложение успешно сохранено.');					$('#editBidForm').hide('slow');					var bid = $('div#bid' + edit_bid_id);					bid							.find('a.edit_button')							.attr('href', 'javascript:editBid(' + edit_bid_id + ');')							.html('изменить');					bid							.find('div.bid_buttons')							.show('slow');					bid							.find('div#comments' + edit_bid_id)							.show('slow');				}				else				{					error('top', 'Предложение не сохранено. Обновите страницу и попробуйте еще раз.');				}			},			error: function(response)			{				error('top', 'Предложение не сохранено. Обновите страницу и попробуйте еще раз.');				$('img.bid_progress').hide();			}		});		// новая комиссия		$('#editBid input.manager_tax').change(function() {			manager_tax = parseGenericTax(this);			refreshEditTotals();		});		// новая комиссия в проентах		$('#editBid input.manager_tax_percentage').change(function() {			manager_tax_percentage = parseGenericTax(this);			manager_tax = Math.ceil(manager_tax_percentage * order_products_cost * 0.01);			refreshEditTotals();		});		// новая комиссия за фото		$('#editBid input.manager_foto_tax').change(function() {			manager_foto_tax = parseGenericTax(this);			refreshEditTotals();		});	});	var editBidFormInitialized = false;	function initEditBidForm()	{		editBidFormInitialized = true;		refreshEditTotals();	}	function showEditBidForm()	{		$('div#editBidForm').show();		if ( ! editBidFormInitialized)		{			initEditBidForm();		}		window.location = '#edit_bid';	}	function editBid(bid_id)	{		initEditBidForm();		$('#editBidForm').show('slow');		var bid = $('div#bid' + bid_id);		bid				.find('a.edit_button')				.attr('href', 'javascript:cancelEditBid(' + bid_id + ');')				.html('отмена');		bid				.find('div.bid_buttons')				.hide('slow');		bid				.find('div#comments' + bid_id)				.hide('slow');	}	function cancelEditBid(bid_id)	{		$('div#editBidForm').hide('slow');		var bid = $('div#bid' + bid_id);		bid			.find('a.edit_button')			.attr('href', 'javascript:editBid(' + bid_id + ');')			.html('изменить');		bid			.find('div.bid_buttons')			.show('slow');		bid			.find('div#comments' + bid_id)			.show('slow');	}		function refreshEditTotals()	{		order_total_cost = 			order_products_cost +			manager_tax +			manager_foto_tax +			extra_tax +			parseFloat(order_delivery_cost);					order_total_cost = Math.ceil(order_total_cost);		$bid = $('div#bid' + edit_bid_id);		$bid			.find('.manager_tax')			.val(manager_tax)			.html(manager_tax);		$bid			.find('.manager_tax_percentage')			.val(manager_tax_percentage)			.html(manager_tax_percentage);		$bid			.find('.manager_foto_tax')			.val(manager_foto_tax)			.html(manager_foto_tax);		$bid			.find('.requested_foto_count')			.val(requested_foto_count)			.html(requested_foto_count);		$bid			.find('.manager_foto_tax')			.val(manager_foto_tax)			.html(manager_foto_tax);		$bid			.find('.extra_tax')			.val(extra_tax)			.html(extra_tax);		$bid			.find('.extra_tax_hint')			.attr('title', extra_tax_hint);		$bid			.find('.order_total_cost')			.val(order_total_cost)			.html(order_total_cost);		$bid			.find('.order_delivery_cost')			.val(order_delivery_cost)			.html(order_delivery_cost);		$bid			.find('.order_delivery_name')			.val(order_delivery_name)			.html(order_delivery_name);		$bid			.find('.order_products_cost')			.val(order_products_cost)			.html(order_products_cost);		$bid			.find('.order_weight')			.val(order_weight)			.html(order_weight);		$bid			.find('.extra_tax_counter')			.val(extra_tax_counter)			.html(extra_tax_counter);	}		function updateBid()	{		$('form#editBid').submit();	}	function editFotoTax()	{		$('#editBidForm .foto_tax_plaintext').hide('fast');		$('#editBidForm .foto_tax_editor').show('fast');	}	function editManagerTax()	{		$('#editBidForm .manager_tax_plaintext').hide('fast');		$('#editBidForm .manager_tax_editor').show('fast');	}	function addExtraTax()	{		var $template = $('#editBidForm .template').clone();		$template			.removeClass('template')			.find('input.extra_tax_value')			.attr('name', 'extra_tax_value' + extra_tax_counter)			.keypress(function(event) {				validate_float(event);			})			.change(function() {				updateExtraTax();			});		$template			.find('input.extra_tax_name')			.attr('name', 'extra_tax_name' + extra_tax_counter)			.change(function() {				updateExtraTax();			});		$('#editBidForm div.extra_tax_box:last').after($template);		$template.show('fast');		extra_tax_counter++;		refreshEditTotals();	}	function parseGenericTax(input)	{		var newTax = $(input).val();		if (newTax == '')		{			newTax = 0;		}		return (isNaN(newTax) ? 0 : parseInt(newTax));	}	// доп. комиссии	function updateExtraTax()	{		extra_tax = 0;		extra_tax_hint = '';		$('#editBidForm input.extra_tax_value').each(function(index, item) {			extra_tax += parseGenericTax(item);		});		$('#editBidForm input.extra_tax_name').each(function(index, item) {			extra_tax_hint += (extra_tax_hint == '' ? '' : ', ');			extra_tax_hint += $(item).val();		});		refreshEditTotals();	}	function removeExtraTax(image)	{		$(image)			.parent()			.parent()			.remove();		updateExtraTax();		refreshEditTotals();	}</script>