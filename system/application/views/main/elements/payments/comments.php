<!--<form class='comments' action='<?= $selfurl ?>addO2iComment/<?= $o2i->order2in_id ?>' method='POST'>	<? if ( ! $comments) : ?>	<div class='comment'>		Пока нет комментариев<br/>	</div>	<? else: ?>	<?  foreach ($comments as $comment) : ?>		<div class='comment'>			<div class='question'>						<span class="name">№<?= $comment->o2icomment_id ?>							<? if ($comment->o2icomment_user == $o2i->order2in_user) : ?>								Вы:								<? else: ?>								Администратор:								<? endif; ?>							<br /><?= formatCommentDate($comment->o2icomment_time) ?>						</span>				<p><?= $comment->o2icomment_text ?></p>			</div>		</div>		<?  endforeach; ?>	<? endif; ?>	<? if ($user) : ?>	<div class='add-comment'>		<div class='textarea'><textarea name='comment'></textarea></div>		<div class='submit'><div><input type='submit' name="add" value="Добавить" /></div></div>	</div>	<? endif; ?></form>--><div class='table bid'>	<div class='angle angle-lt'></div>	<div class='angle angle-rt'></div>	<div class='angle angle-lb'></div>	<div class='angle angle-rb'></div>	<div class='table admin-inside' style="margin-top:0px;padding-top:0px;padding-bottom:0;" id="comments<?= $comment->o2icomment_id ?>">		<table>			<? if ($comments) : foreach ($comments as $comment) : ?>			<tr class="comment">				<td>					<? View::show('main/elements/payments/comment', array('comment' => $comment)); ?>				</td>			</tr>			<? endforeach; endif; ?>			<tr class='last-row'>				<td>					<form class='admin-inside' action="<?= $selfurl ?>addPaymentComment/<?= $o2i->order2in_id ?>"						  id="commentForm<?= $comment->o2icomment_id ?>" method="POST">						<div class='add-comment' style="display:none;">							<div><textarea id='comment<?= $comment->o2icomment_id ?>' name='comment'></textarea></div>							<div class='submit comment-submit'><div><input type='submit' name="add" value="Добавить" /></div></div>						</div>					</form>				</td>			</tr>			<tr class='last-row'>				<td>					<div class='floatleft' style="width:100%;">						<div class='submit add_comment'>							<div>								<input type='button' class="" value='Добавить комментарий' onclick="addComment('<?= $comment->o2icomment_id ?>');" />							</div>						</div>						<div class='submit save_comment' style="display:none;">							<div>								<input type='button' class="" value='Сохранить' onclick="saveComment('<?= $comment->o2icomment_id ?>');" />							</div>						</div>						<div class='submit cancel_comment' style="display:none;">							<div>								<input type='button' class="" value='Отмена' onclick="cancelComment('<?= $comment->o2icomment_id ?>');" />							</div>						</div>						<div class='submit expand_comments' <? if (empty($comments)) : ?>style='display:none;'<? 						endif; ?>>							<div>								<input type='button' value='Развернуть переписку' onclick="expandComments('<?= $comment->o2icomment_id ?>');" />							</div>						</div>						<div class='submit collapse_comments' style='display:none;'>							<div>								<input type='button' value='Свернуть переписку' onclick="collapseComments('<?= $comment->o2icomment_id ?>');" />							</div>						</div>						<div class='floatleft'>							<img class="float comment_progress" style="display:none;margin:0px;margin-top:5px;" src="/static/images/lightbox-ico-loading.gif"/>						</div>					</div>				</td>			</tr>		</table>	</div></div><script>$(function() {	$('#commentForm<?= $comment->o2icomment_id ?>').ajaxForm({		dataType: 'html',		iframe: true,		beforeSubmit: function(formData, jqForm, options)		{			beforeSubmitComment(<?= $comment->o2icomment_id ?>);		},		success: function(response)		{			successSubmitComment(response, <?= $comment->o2icomment_id ?>);		},		error: function(response)		{			errorSubmitComment(response, <?= $comment->o2icomment_id ?>);		}	});	<?= editor("comment{$comment->o2icomment_id}", 90, 920, 'PackageComment') ?>});// BOF: комментарииfunction addComment(comment_id){	$('#comments' + comment_id)		.find('.add_comment,.expand_comments,.collapse_comments,.delete_comment')		.hide('slow');	$('#comments' + comment_id)		.find('.save_comment,.cancel_comment,.add-comment')		.show('slow');}function cancelComment(comment_id){	$('#comments' + comment_id)		.find('.add_comment,.delete_comment')		.show('slow');	if (true == eval('window.comment' + comment_id + 'expanded'))	{		$('#comments' + comment_id)			.find('.collapse_comments')			.show('slow');	}	else	{		$('#comments' + comment_id)			.find('.expand_comments')			.show('slow');	}	$('#comments' + comment_id)		.find('.save_comment,.cancel_comment,.add-comment')		.hide('slow');}function saveComment(comment_id){	$('#commentForm' + comment_id)		.submit();}function beforeSubmitComment(comment_id){	var $comments = $('div#comments' + comment_id);	$comments		.find('img.comment_progress')		.show('slow');	$comments		.find('.cancel_comment')		.hide('slow');}function successSubmitComment(response, comment_id){	var $comments = $('div#comments' + comment_id);	$comments		.find('img.comment_progress')		.hide('slow');	if (response)	{		success('top', 'Комментарий добавлен!');		$comments			.find('.add_comment,.delete_comment')			.show('slow');		$comments			.find('.save_comment,.collapse_comments,.expand_comments,.cancel_comment,.add-comment')			.hide('slow');		$comments			.find('tr.comment:last')			.after('<tr class="comment"><td>' + response + '</td></tr>');		$comments			.find('tr.comment')			.show('slow');		$comments			.find('.collapse_comments')			.show('slow');		$comments			.find('.expand_comments')			.hide('slow');		eval('window.comment' + comment_id + 'expanded = true;');		//$('.add-comment').html(''); TODO: cleanup the textarea	}	else	{		error('top', 'Комментарий не добавлен. Напишите что-нибудь и сохраните его еще раз.');		$comments			.find('.cancel_comment')			.show('slow');	}}function errorSubmitComment(response, comment_id){	var $comments = $('div#comments' + comment_id);	$comments		.find('img.comment_progress')		.hide('slow');	$comments		.find('.cancel_comment')		.show('slow');	error('top', 'Комментарий не добавлен. Напишите что-нибудь и сохраните его еще раз.');}function expandComments(comment_id){	var $comments = $('div#comments' + comment_id);	$comments		.find('tr.comment')		.show('slow');	$comments		.find('div.expand_comments')		.hide('slow');	$comments		.find('div.collapse_comments')		.show('slow');	eval('window.comment' + comment_id + 'expanded = true;');}function collapseComments(comment_id){	var $comments = $('div#comments' + comment_id);	$comments		.find('tr.comment')		.hide('slow');	$comments		.find('div.expand_comments')		.show('slow');	$comments		.find('div.collapse_comments')		.hide('slow');	eval('window.comment' + comment_id + 'expanded = false;');}// EOF: комментарии</script>